(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["apiUtil-update-main"],{"1c44":function(t,e,i){var s=i("efcc");"string"===typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);var n=i("4f06").default;n("5e69f4ca",s,!0,{sourceMap:!1,shadowMode:!1})},4829:function(t,e,i){"use strict";var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",[i("cu-custom",{attrs:{bgColor:"bg-white",isBack:!0}},[i("template",{attrs:{slot:"backText"},slot:"backText"},[t._v("返回")]),i("template",{attrs:{slot:"content"},slot:"content"},[t._v("软件更新")])],2),i("v-uni-view",{staticClass:"flex-column"},[i("v-uni-view",{staticClass:"content"},[i("v-uni-image",{staticClass:"logo",attrs:{src:"https://imgt1.oss-cn-shanghai.aliyuncs.com/ecAllRes/update/up-circle.png"}}),i("v-uni-view",{staticClass:"mainInfo"},[i("v-uni-text",{staticClass:"title"},[t._v(t._s(t.info)+" | "+t._s(t.Minfo))]),i("v-uni-text",{staticClass:"tip"},[t._v("\\n"+t._s(t.Mtip))])],1),i("v-uni-text",{staticClass:"line"})],1),i("v-uni-view",[i("v-uni-view",{staticClass:"infoContentTitle"},[i("v-uni-image",{staticClass:"infoPic",attrs:{src:"https://imgt1.oss-cn-shanghai.aliyuncs.com/ecAllRes/update/info-circle.png"}}),i("v-uni-text",{staticClass:"infoTitle"},[t._v("更新摘要")])],1),i("v-uni-view",{staticClass:"infoContent"},[i("v-uni-text",{staticClass:"updateInfo"},[t._v(t._s(t.updateInfo))])],1)],1),t.currentIsLatest?t._e():i("v-uni-view",[i("v-uni-view",{staticClass:"infoContentTitle"},[i("v-uni-image",{staticClass:"infoPic",attrs:{src:"https://imgt1.oss-cn-shanghai.aliyuncs.com/ecAllRes/update/sync.png"}}),i("v-uni-text",{staticClass:"infoTitle"},[t._v("更新大小")])],1),i("v-uni-view",{staticClass:"infoContent"},[i("v-uni-text",{staticClass:"updateInfo"},[t._v(t._s(t.packgeSize))])],1)],1),i("v-uni-view",{staticClass:"minorContent bottom_aera"},[t.startProgress&&!t.currentIsLatest?i("v-uni-view",{staticClass:"smallTitle"},[i("v-uni-text",[t._v("下载进度:"+t._s(t.downloadProgress)+"%")]),i("v-uni-progress",{attrs:{percent:t.downloadProgress,"stroke-width":"4"}})],1):t._e(),t.startProgress||t.currentIsLatest?t._e():i("v-uni-button",{attrs:{type:"primary"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.handleUpdate()}}},[t._v("立即更新")]),t.currentIsLatest?i("v-uni-button",{attrs:{loading:t.buttonLoading,type:"primary"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.getLatest()}}},[t._v("检查更新")]):t._e()],1)],1)],1)},n=[];i.d(e,"a",function(){return s}),i.d(e,"b",function(){return n})},"7e8e":function(t,e,i){"use strict";i.r(e);var s=i("4829"),n=i("cc5a");for(var a in n)"default"!==a&&function(t){i.d(e,t,function(){return n[t]})}(a);i("ad9f");var o=i("f0c5"),l=Object(o["a"])(n["default"],s["a"],s["b"],!1,null,"13080ee6",null);e["default"]=l.exports},ad9f:function(t,e,i){"use strict";var s=i("1c44"),n=i.n(s);n.a},cc5a:function(t,e,i){"use strict";i.r(e);var s=i("e85e"),n=i.n(s);for(var a in s)"default"!==a&&function(t){i.d(e,t,function(){return s[t]})}(a);e["default"]=n.a},e85e:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i("3b2b"),i("4917");var s={components:{},data:function(){return{info:"正在加载",Minfo:"未知",Mtip:"",updateInfo:"无",latest:null,packgeSize:null,packgePath:null,downloadTask:null,downloadProgress:0,buttonLoading:!1,installed:!1,startProgress:!1,currentIsLatest:!0}},onReady:function(){this.getLatest();var t=uni.getStorageSync("updated");t.packgePath&&(this.packgePath=t.packgePath)},onShow:function(){!0===this.installed&&this.packgePath&&(this.installed=!1,this.haveDownloaded())},onUnload:function(){this.downloadTask&&(this.closeTask(),this.showToast("更新被取消"))},onPullDownRefresh:function(){this.getLatest(),uni.stopPullDownRefresh()},methods:{showToast:function(t){uni.showToast({title:t,duration:3e3,icon:"none"})},installPackge:function(){plus.runtime.install(this.packgePath,{force:!0}),this.installed=!0,uni.setStorage({key:"updated",data:{completed:!0,packgePath:this.packgePath},success:function(e){t.log("成功保存更新记录")}}),this.packgePath.match(RegExp(/.wgt/))&&(this.installed=!1,uni.showModal({title:"提示",content:"应用将重启以完成更新",showCancel:!1,complete:function(){plus.runtime.restart()}}))},haveDownloaded:function(){var t=this;uni.showModal({title:"更新尚未完成",content:"您已下载更新包，但是还没有完成安装，请问是否要继续安装更新包呢？",success:function(e){e.confirm?t.installPackge():e.cancel&&t.showToast("更新被取消")}})},getLatest:function(){var t=this;this.info="正在加载",this.Minfo="未知",this.updateInfo="无",this.buttonLoading=!0,this.latest=null,uni.request({url:"https://api.ecshop.yunyingbao.net/pure-updater/version/info.json",method:"GET",data:{search:"latestInfo"},success:function(e){if(200===e.statusCode){var i=e.data;t.latest=i.latest.info,t.buttonLoading=!1,t.checkLatest()}}})},checkLatest:function(){this.latest.id?this.$current.id!=this.latest.id?(this.currentIsLatest=!1,this.Mtip="发现新版本",this.info=this.latest.name+" "+this.latest.number,this.updateInfo=this.latest.info,this.packgeSize=(this.latest.packgeSize/1048576).toFixed(2)+"MB",this.setMinfo(this.latest.type)):(this.showToast("当前是最新版了"),this.currentIsLatest=!0,this.Mtip="当前是最新版",this.info=this.latest.name+" "+this.latest.number,this.updateInfo=this.latest.info,this.setMinfo(this.latest.type)):this.Mtip="未找到发行版本"},setMinfo:function(t){switch(t){case"base":this.Minfo="结构版";break;case"alpha":this.Minfo="内测版";break;case"beta":this.Minfo="公测版";break;case"rc":this.Minfo="终测版";break;case"release":this.Minfo="正式版";break;default:this.Minfo="未知"}},closeTask:function(){this.downloadTask.abort(),this.downloadTask=null,this.startProgress=!1},createTask:function(t){var e=this;this.packgePath?this.haveDownloaded():(this.downloadProgress=0,this.startProgress=!0,this.downloadTask=uni.downloadFile({url:t,success:function(t){200===t.statusCode&&uni.saveFile({tempFilePath:t.tempFilePath,success:function(t){e.packgePath=t.savedFilePath,e.installPackge(),e.closeTask()}})}}),this.downloadTask.onProgressUpdate(function(t){e.downloadProgress=t.progress}))},handleUpdate:function(){"android"===plus.os.name.toLowerCase()?this.latest.androidLink&&"#"!==this.latest.androidLink?this.createTask(this.latest.androidLink):this.showToast("未找到下载地址"):this.latest.iosLink&&"#"!==this.latest.iosLink?this.latest.iosLink.match(RegExp(/.wgt/))?this.createTask(this.latest.iosLink):plus.runtime.openURL(this.latest.iosLink):this.showToast("未找到ios商店地址")}}};e.default=s}).call(this,i("5a52")["default"])},efcc:function(t,e,i){e=t.exports=i("2350")(!1),e.push([t.i,'@charset "UTF-8";\n/**\r\n * 这里是uni-app内置的常用样式变量\r\n *\r\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\r\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\r\n *\r\n */\n/**\r\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\r\n *\r\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\r\n */\n/* 页面左右间距 */\n/* 文字尺寸 */\n/*文字颜色*/\n/* 边框颜色 */\n/* 图片加载中颜色 */\n/* 行为相关颜色 */.flex-column[data-v-13080ee6]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-orient:vertical;-webkit-box-direction:normal;-webkit-flex-direction:column;flex-direction:column}.content[data-v-13080ee6]{text-align:center}.minorContent[data-v-13080ee6]{width:100%;padding:0 %?50?%}.process[data-v-13080ee6]{margin-top:%?200?%;margin-left:30%}.logo[data-v-13080ee6]{height:%?200?%;width:%?200?%;margin-top:%?100?%}.title[data-v-13080ee6]{font-size:%?36?%;color:#373737;font-weight:700}.infoTitle[data-v-13080ee6]{font-size:%?32?%;color:#373737;padding-left:%?15?%;font-weight:700}.tip[data-v-13080ee6]{font-size:%?28?%;color:#7e7e83;vertical-align:text-top}.bottom_aera[data-v-13080ee6]{position:absolute;bottom:0;height:12%}.line[data-v-13080ee6]{padding:0 %?600?%;border-bottom:%?2?% solid #d8d8d8}.infoPic[data-v-13080ee6]{height:%?50?%;width:%?50?%}.infoContentTitle[data-v-13080ee6]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center;padding:%?40?% %?40?%}.infoContent[data-v-13080ee6]{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-box-align:center;-webkit-align-items:center;align-items:center}.updateInfo[data-v-13080ee6]{font-size:%?28?%;color:#7e7e83;padding:0 %?80?%}.smallTitle[data-v-13080ee6]{font-size:%?26?%;font-weight:500;padding:%?20?% 0;line-height:1.5;color:#888}',""])}}]);